# 1-PLAN: 플랜 수립 (PM 직접 수행)

> **이 단계는 PM이 직접 수행합니다.** 서브에이전트에 위임하지 않습니다.
> 사용자와의 논의가 필요하기 때문입니다.

## 입력
- 요청 내용: {{요청내용}}

## 역할
사용자의 요청을 분석하여 **구현 대상과 목표를 명확히** 하고 **사용자 승인**을 받아라.

---

## 단계

### 1. 요구사항 논의
사용자와 대화하여 요구사항을 명확히 한다.

**확인할 것:**
- **구현 대상** (파일명, 클래스명, 함수명 등) → 문서 파일명에 사용
- 기능의 정확한 동작 (입력 → 출력)
- 엣지 케이스 처리 방식
- 에러 상황 대응
- 모호하거나 불명확한 부분

**금지:**
- 추측으로 진행
- 불명확한 채로 넘어가기

**대상 결정 예시:**
```
요청: "메시지 스토어에 대화 삭제 기능 추가"
→ 대상: MessageStore (문서: wip/MessageStore-plan.md)

요청: "RelayClient 재연결 로직"
→ 대상: RelayClient-reconnect (문서: wip/RelayClient-reconnect-plan.md)
```

### 2. 코드베이스 탐색
관련 코드를 파악하여 구현 방향을 결정한다.

**확인할 것:**
- 기존 유사 기능/패턴
- 영향받는 파일 목록
- 프로젝트 컨벤션 (네이밍, 구조)
- 의존성 관계

### 3. 규모 검토
플랜이 너무 크면 분할을 제안한다.

**분할 기준:**
- 테스트 케이스 7개 초과 예상
- 여러 개의 독립적인 기능 포함
- 예상 구현 파일 3개 초과

**분할 시:**
```
⚠️ 플랜 분할 필요

이 기능은 다음과 같이 나눌 수 있습니다:
1. [첫 번째 단위] - 설명
2. [두 번째 단위] - 설명

어떤 것부터 진행할까요?
```

### 4. 문서 작성

#### wip/[대상]-plan.md

```markdown
# [대상] 구현 계획

## 구현 목표
[한 문장으로 요약]

## 구현 방향
[어떻게 구현할지 설명]

## 영향 범위
- 수정 필요: ...
- 신규 생성: ...
```

#### wip/[대상]-tdd.md

```markdown
# [대상] TDD

## 상태
📋 1-PLAN

## 테스트 케이스
(2-TEST에서 작성)

## 파일
- 플랜: wip/[대상]-plan.md
- 테스트: (2-TEST에서 기록)
- 구현: (4-IMPL에서 기록)

## 재시도 횟수
- 2-TEST → 3-VERIFY: 0/3
- 4-IMPL: 0/3

## 로그
- [YYMMDD HH:MM] 1-PLAN 시작
```

### 5. 사용자 승인 요청

**출력 형식:**
```
📋 TDD 플랜

## 구현 목표
[목표]

## 구현 방향
[방향]

## 영향 범위
- 수정: ...
- 신규: ...

이 플랜으로 진행할까요?
```

---

## ⚠️ 중요: 명시적 승인 대기

**사용자의 명시적 승인이 있을 때만 2-TEST로 진행한다.**

- 승인 예시: "진행해", "OK", "좋아", "ㅇㅇ", "네"
- 플랜 제시 후 자동으로 다음 단계로 넘어가지 않음
- 피드백이 있으면 플랜 수정 후 재요청

---

## 출력

- 승인 시: plan 문서 경로, tdd 문서 경로, "2-TEST 진행" 메시지
- 수정 필요 시: 피드백 반영 후 재확인
- 분할 필요 시: 분할 제안 후 선택된 부분만 진행
