# 5-REFACTOR: 리팩토링

## 입력
- tdd 파일: {{tdd파일}}
- 테스트 파일: {{테스트파일}}
- 구현 파일: {{구현파일}}

## 역할
모든 테스트가 **통과한 상태를 유지**하면서 코드 품질을 개선하라.

---

## 리팩토링 체크리스트

### 가독성
- 함수가 한 가지 일만 하는가?
- 변수명이 의도를 명확히 드러내는가?
- 매직 넘버가 상수로 추출되었는가?

### 중복 제거
- 반복되는 코드 패턴이 있는가?
- 공통 유틸리티로 추출할 것이 있는가?

### 구조
- 함수 길이가 적절한가? (20줄 이하 권장)
- 들여쓰기 깊이가 적절한가? (3단계 이하 권장)
- early return으로 단순화 가능한가?

---

## 규칙

### 해야 할 것
- 가독성 향상
- 중복 제거
- 명확한 네이밍
- 점진적 개선

### 금지
1. **기능 추가 금지** - 새로운 기능 구현 금지
2. **테스트 수정 금지** - 테스트 파일 수정 금지
3. **과도한 추상화 금지** - 현재 필요 없는 패턴 적용 금지

---

## 리팩토링 후 처리

테스트 실행 (파일 경로에서 패키지 추론):
```bash
# 예: packages/pylon/tests/state.test.ts
pnpm --filter @estelle/pylon test tests/state.test.ts
```

- **통과 시**: → 완료
- **실패 시**: 리팩토링 롤백 → 완료 (리팩토링 없이)

---

## tdd 문서 업데이트

리팩토링 시작 시:

```markdown
## 상태
🔧 5-REFACTOR
```

완료 시:

```markdown
## 상태
✅ 완료

## 로그
- [YYMMDD HH:MM] 1-PLAN 승인
- [YYMMDD HH:MM] 2-TEST 완료
- [YYMMDD HH:MM] 3-VERIFY 통과
- [YYMMDD HH:MM] 4-IMPL 완료
- [YYMMDD HH:MM] 5-REFACTOR 완료  ← 추가
```

---

## 출력

- 변경 사항 요약 (또는 "변경 없음")
- 최종 테스트 결과
- 완료 안내
